<!DOCTYPE html><html class="2xl:text-[20px]" dir="ltr" lang="en"><head><meta charset="UTF-8"><meta content="width=device-width,initial-scale=1" name="viewport"><link href="/sitemap-index.xml" rel="sitemap"><link href="/_astro/favicon.CGiRCjPI.ico" rel="shortcut icon"><link href="/_astro/favicon.vp_fBu0c.svg" rel="icon" type="image/svg+xml"><style>:root{--aw-font-sans:'Inter Variable';--aw-font-serif:'Inter Variable';--aw-font-heading:'Inter Variable';--aw-color-primary:rgb(1 97 239);--aw-color-secondary:rgb(1 84 207);--aw-color-accent:rgb(109 40 217);--aw-color-text-heading:rgb(0 0 0);--aw-color-text-default:rgb(16 16 16);--aw-color-text-muted:rgb(16 16 16 / 66%);--aw-color-bg-page:rgb(255 255 255);--aw-color-bg-page-dark:rgb(3 6 32)}.dark{--aw-font-sans:'Inter Variable';--aw-font-serif:'Inter Variable';--aw-font-heading:'Inter Variable';--aw-color-primary:rgb(1 97 239);--aw-color-secondary:rgb(1 84 207);--aw-color-accent:rgb(109 40 217);--aw-color-text-heading:rgb(247, 248, 248);--aw-color-text-default:rgb(229 236 246);--aw-color-text-muted:rgb(229 236 246 / 66%);--aw-color-bg-page:rgb(3 6 32)}</style><script>!function(){const e="system";function t(e){"dark"===e?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark");const t=document.querySelectorAll("[data-aw-toggle-color-scheme] > input");t&&t.length&&t.forEach((t=>{t.checked="dark"!==e}))}e&&e.endsWith(":only")||(localStorage.theme,0)?t(e.replace(":only","")):"dark"===localStorage.theme||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):t("light")}()</script><title>how to setup a cdh cluster — Devops</title><meta content="🚀 A devops&#39;s blogs." name="description"><meta content="index,follow" name="robots"><link href="https://astrowind.vercel.app/how-to-setup-a-cdh-cluster" rel="canonical"><meta content="how to setup a cdh cluster" property="og:title"><meta content="🚀 A devops&#39;s blogs." property="og:description"><meta content="https://astrowind.vercel.app/how-to-setup-a-cdh-cluster" property="og:url"><meta content="article" property="og:type"><meta content="https://tm-image.tianyancha.com/tm/c5f83ded53e09ae36ee524bf9e795b96.jpg" property="og:image"><meta content="1200" property="og:image:width"><meta content="827" property="og:image:height"><meta content="en" property="og:locale"><meta content="Devops&#39;s corner" property="og:site_name"><meta content="summary_large_image" name="twitter:card"><meta content="@anchorlau" name="twitter:site"><meta content="@anchorlau" name="twitter:creator"><meta content="orcPxI47GSa-cRvY11tUe6iGg2IO_RPvnA1q95iEM3M" name="google-site-verification"><meta content="true" name="astro-view-transitions-enabled"><meta content="swap" name="astro-view-transitions-fallback"><script src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.CtSceO8m.js" type="module"></script><link href="/_astro/privacy.CmR5WFJ4.css" rel="stylesheet"></head><body class="tracking-tight antialiased bg-page text-default"><header class="mx-auto w-full border-b border-gray-50/0 ease-in-out flex-none sticky top-0 transition-[opacity] z-40" data-aw-sticky-header="true" id="header"><div class="absolute inset-0"></div><div class="mx-auto w-full max-w-7xl md:grid md:grid-cols-3 md:items-center md:px-6 px-3 py-3 relative text-default"><div class="flex justify-between"><a href="/" class="flex items-center"><span class="ml-2 rtl:ml-0 rtl:mr-2 dark:text-white font-bold md:text-xl self-center text-2xl text-gray-900 whitespace-nowrap">🚀 Devops&#39;s corner</span></a><div class="flex items-center md:hidden"><button class="flex items-center cursor-pointer flex-col group h-12 justify-center rounded w-12" aria-label="Toggle Menu" type="button" data-aw-toggle-menu><span class="sr-only">Toggle Menu</span> <span class="w-6 bg-black dark:bg-white duration-200 ease h-0.5 my-1 opacity-80 rounded-full transform transition group-[.expanded]:rotate-45 group-[.expanded]:translate-y-2.5" aria-hidden="true"></span> <span class="w-6 bg-black dark:bg-white duration-200 ease h-0.5 my-1 opacity-80 rounded-full transform transition group-[.expanded]:opacity-0" aria-hidden="true"></span> <span class="w-6 bg-black dark:bg-white duration-200 ease h-0.5 my-1 opacity-80 rounded-full transform transition group-[.expanded]:-rotate-45 group-[.expanded]:-translate-y-2.5" aria-hidden="true"></span></button></div></div><nav aria-label="Main navigation" class="items-center md:w-auto w-full hidden md:flex md:justify-self-center md:mx-5 md:overflow-x-auto md:overflow-y-visible overflow-x-hidden overflow-y-auto text-default"><ul class="flex flex-col font-medium md:flex-row md:justify-center md:self-center md:text-[0.9375rem] md:w-auto text-xl tracking-[0.01rem] w-full"><li class><a href="/about" class="flex items-center dark:hover:text-white hover:text-link px-4 py-3 whitespace-nowrap">About me</a></li><li class><a href="/contact" class="flex items-center dark:hover:text-white hover:text-link px-4 py-3 whitespace-nowrap">Contact</a></li><li class><a href="/blog" class="flex items-center dark:hover:text-white hover:text-link px-4 py-3 whitespace-nowrap">Blog List</a></li></ul></nav><div class="items-center md:w-auto w-full hidden md:flex bottom-0 fixed justify-end left-0 md:justify-self-end md:mb-0 md:p-0 md:self-center md:static p-3 rtl:left-auto rtl:right-0"><div class="flex items-center justify-between md:w-auto w-full"><div class="flex"><button class="items-center dark:focus:ring-gray-700 dark:hover:bg-gray-700 dark:text-gray-400 focus:outline-none focus:ring-4 focus:ring-gray-200 hover:bg-gray-100 inline-flex p-2.5 rounded-lg text-muted text-sm" aria-label="Toggle between Dark and Light mode" type="button" data-aw-toggle-color-scheme><svg class="w-6 h-6 md:h-5 md:inline-block md:w-5" data-icon="tabler:sun" height="1em" width="1em"><symbol id="ai:tabler:sun" viewBox="0 0 24 24"><path d="M8 12a4 4 0 1 0 8 0a4 4 0 1 0-8 0m-5 0h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7l-.7.7m0 11.4l.7.7m-12.1-.7l-.7.7" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></symbol><use href="#ai:tabler:sun"></use></svg></button> <a class="items-center dark:focus:ring-gray-700 dark:hover:bg-gray-700 dark:text-gray-400 focus:outline-none focus:ring-4 focus:ring-gray-200 hover:bg-gray-100 inline-flex p-2.5 rounded-lg text-muted text-sm"></a></div></div></div></div></header><main><section class="mx-auto lg:py-20 py-8 sm:py-16"><article><header class="intersect-once intersect-quarter motion-safe:md:intersect:animate-fade motion-safe:md:opacity-0"><div class="flex flex-col justify-between max-w-3xl mx-auto sm:flex-row sm:px-6 mb-2 mt-0 px-4 sm:items-center"><p><svg class="inline-block -mt-0.5 dark:text-gray-400 h-4 w-4" data-icon="tabler:clock" height="1em" width="1em"><symbol id="ai:tabler:clock" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0-18 0"/><path d="M12 7v5l3 3"/></g></symbol><use href="#ai:tabler:clock"></use></svg> <time class="inline-block" datetime="Tue Aug 06 2024 08:00:00 GMT+0800 (中国标准时间)">Aug 6, 2024</time> &nbsp;· <span>19</span> min read</p></div><h1 class="mx-auto max-w-3xl sm:px-6 px-4 font-bold font-heading leading-tighter md:text-5xl text-4xl tracking-tighter">how to setup a cdh cluster</h1><p class="mx-auto max-w-3xl sm:px-6 px-4 dark:text-slate-400 mb-8 md:text-2xl mt-4 text-justify text-muted text-xl"></p><img alt loading="eager" src="https://tm-image.tianyancha.com/tm/c5f83ded53e09ae36ee524bf9e795b96.jpg" class="mx-auto bg-gray-400 dark:bg-slate-700 lg:max-w-[900px] max-w-full mb-6 sm:rounded-md" crossorigin="anonymous" decoding="async" height="506" referrerpolicy="no-referrer" sizes="(max-width: 900px) 400px, 900px" srcset="https://tm-image.tianyancha.com/tm/c5f83ded53e09ae36ee524bf9e795b96.jpg 400w, https://tm-image.tianyancha.com/tm/c5f83ded53e09ae36ee524bf9e795b96.jpg 900w, https://tm-image.tianyancha.com/tm/c5f83ded53e09ae36ee524bf9e795b96.jpg 1800w" style="object-fit:cover;object-position:center;max-width:900px;max-height:506px;aspect-ratio:1.7786561264822134;width:100%" width="900"></header><div class="mx-auto max-w-3xl sm:px-6 px-6 mt-8 dark:prose-a:text-blue-400 dark:prose-headings:text-slate-300 dark:prose-invert lg:prose-xl prose prose-a:text-primary prose-headings:font-bold prose-headings:font-heading prose-headings:leading-tighter prose-headings:scroll-mt-[80px] prose-headings:tracking-tighter prose-img:rounded-md prose-img:shadow-lg prose-li:my-0 prose-md"><h1 id="一环境准备">一、环境准备</h1><h2 id="1软件版本选择">1、软件版本选择</h2><div style="overflow:auto"><table><thead><tr><th>类目</th><th>版本</th></tr></thead><tbody><tr><td>操作系统</td><td>CentOS Linux release 7.9</td></tr></tbody></table></div><h2 id="2节点准备三个节点">2、节点准备（三个节点）</h2><div style="overflow:auto"><table><thead><tr><th>名称</th><th>IP</th></tr></thead><tbody><tr><td>namenode01</td><td>192.168.125.61</td></tr><tr><td>namenode02</td><td>192.168.125.62</td></tr><tr><td>datanode01</td><td>192.168.125.63</td></tr><tr><td>datanode02</td><td>192.168.125.64</td></tr><tr><td>datanode03</td><td>192.168.125.65</td></tr></tbody></table></div><h2 id="3系统配置">3、系统配置</h2><pre class="astro-code github-dark" data-language="bash" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#b392f0">yum</span><span style="color:#79b8ff"> -y</span><span style="color:#9ecbff"> install</span><span style="color:#9ecbff"> git</span></span>
<span class="line"><span style="color:#b392f0">git</span><span style="color:#9ecbff"> clone</span><span style="color:#79b8ff"> --depth=1</span><span style="color:#9ecbff"> https://gitee.com/dlcf/studio</span></span>
<span class="line"><span style="color:#79b8ff">cd</span><span style="color:#9ecbff"> /root/studio/scripts/linux</span></span>
<span class="line"><span style="color:#b392f0">rm</span><span style="color:#9ecbff"> 03-install-docker.sh</span></span>
<span class="line"><span style="color:#b392f0">vim</span><span style="color:#9ecbff"> 05-upgrade-kernel.sh</span></span>
<span class="line"><span style="color:#b392f0">输入%s/kernel-ml-devel</span><span style="color:#9ecbff"> kernel-ml/kernel-lt.x86_64/g回车，再输入:wq保存。</span></span>
<span class="line"><span style="color:#b392f0">bash</span><span style="color:#9ecbff"> init-all.sh</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a737d"># 重启以验证配置是否生效</span></span>
<span class="line"><span style="color:#b392f0">shtudown</span><span style="color:#79b8ff"> -r</span><span style="color:#9ecbff"> now</span></span></code></pre><h2 id="4环境配置">4、环境配置</h2><p>新建一个sh脚本，把下面内容复制进去并根据需要增加，然后在新加的节点上运行脚本。</p><pre class="astro-code github-dark" data-language="bash" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#f97583">if</span><span style="color:#e1e4e8"> [ </span><span style="color:#9ecbff">`</span><span style="color:#b392f0">grep</span><span style="color:#79b8ff"> 222.222.222.222</span><span style="color:#9ecbff"> /etc/resolv.conf </span><span style="color:#f97583">|</span><span style="color:#b392f0"> wc</span><span style="color:#79b8ff"> -l</span><span style="color:#9ecbff">`</span><span style="color:#f97583"> -lt</span><span style="color:#79b8ff"> 1</span><span style="color:#e1e4e8"> ]; </span><span style="color:#f97583">then</span></span>
<span class="line"><span style="color:#79b8ff">  echo</span><span style="color:#9ecbff"> "nameserver 222.222.222.222"</span><span style="color:#f97583"> >></span><span style="color:#9ecbff"> /etc/resolv.conf</span></span>
<span class="line"><span style="color:#f97583">fi</span></span>
<span class="line"><span style="color:#f97583">if</span><span style="color:#e1e4e8"> [ </span><span style="color:#9ecbff">`</span><span style="color:#b392f0">grep</span><span style="color:#79b8ff"> 114.114.114.114</span><span style="color:#9ecbff"> /etc/resolv.conf </span><span style="color:#f97583">|</span><span style="color:#b392f0"> wc</span><span style="color:#79b8ff"> -l</span><span style="color:#9ecbff">`</span><span style="color:#f97583"> -lt</span><span style="color:#79b8ff"> 1</span><span style="color:#e1e4e8"> ]; </span><span style="color:#f97583">then</span></span>
<span class="line"><span style="color:#79b8ff">  echo</span><span style="color:#9ecbff"> "nameserver 114.114.114.114"</span><span style="color:#f97583"> >></span><span style="color:#9ecbff"> /etc/resolv.conf</span></span>
<span class="line"><span style="color:#f97583">fi</span></span>
<span class="line"><span style="color:#f97583">if</span><span style="color:#e1e4e8"> [ </span><span style="color:#9ecbff">`</span><span style="color:#b392f0">grep</span><span style="color:#9ecbff"> k8s.lb /etc/hosts </span><span style="color:#f97583">|</span><span style="color:#b392f0"> wc</span><span style="color:#79b8ff"> -l</span><span style="color:#9ecbff">`</span><span style="color:#f97583"> -lt</span><span style="color:#79b8ff"> 1</span><span style="color:#e1e4e8"> ]; </span><span style="color:#f97583">then</span></span>
<span class="line"><span style="color:#79b8ff">  echo</span><span style="color:#9ecbff"> "192.168.125.61 namenode01"</span><span style="color:#f97583"> >></span><span style="color:#9ecbff"> /etc/hosts</span></span>
<span class="line"><span style="color:#79b8ff">  echo</span><span style="color:#9ecbff"> "192.168.125.62 namenode02"</span><span style="color:#f97583"> >></span><span style="color:#9ecbff"> /etc/hosts</span></span>
<span class="line"><span style="color:#79b8ff">  echo</span><span style="color:#9ecbff"> "192.168.125.63 datanode01"</span><span style="color:#f97583"> >></span><span style="color:#9ecbff"> /etc/hosts</span></span>
<span class="line"><span style="color:#79b8ff">  echo</span><span style="color:#9ecbff"> "192.168.125.64 datanode02"</span><span style="color:#f97583"> >></span><span style="color:#9ecbff"> /etc/hosts</span></span>
<span class="line"><span style="color:#79b8ff">  echo</span><span style="color:#9ecbff"> "192.168.125.65 datanode03"</span><span style="color:#f97583"> >></span><span style="color:#9ecbff"> /etc/hosts</span><span style="color:#e1e4e8">  </span></span>
<span class="line"><span style="color:#f97583">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a737d"># 配置hostname</span></span>
<span class="line"><span style="color:#f97583">if</span><span style="color:#e1e4e8"> [ </span><span style="color:#9ecbff">`</span><span style="color:#b392f0">ip</span><span style="color:#9ecbff"> a</span><span style="color:#f97583">|</span><span style="color:#b392f0">grep</span><span style="color:#9ecbff"> "192.168.125.61"</span><span style="color:#f97583">|</span><span style="color:#b392f0">wc</span><span style="color:#79b8ff"> -l</span><span style="color:#9ecbff">`</span><span style="color:#f97583"> -gt</span><span style="color:#79b8ff"> 0</span><span style="color:#e1e4e8"> ]; </span><span style="color:#f97583">then</span></span>
<span class="line"><span style="color:#b392f0">  hostnamectl</span><span style="color:#9ecbff"> set-hostname</span><span style="color:#9ecbff"> namenode01</span></span>
<span class="line"><span style="color:#f97583">fi</span></span>
<span class="line"><span style="color:#f97583">if</span><span style="color:#e1e4e8"> [ </span><span style="color:#9ecbff">`</span><span style="color:#b392f0">ip</span><span style="color:#9ecbff"> a</span><span style="color:#f97583">|</span><span style="color:#b392f0">grep</span><span style="color:#9ecbff"> "192.168.125.62"</span><span style="color:#f97583">|</span><span style="color:#b392f0">wc</span><span style="color:#79b8ff"> -l</span><span style="color:#9ecbff">`</span><span style="color:#f97583"> -gt</span><span style="color:#79b8ff"> 0</span><span style="color:#e1e4e8"> ]; </span><span style="color:#f97583">then</span></span>
<span class="line"><span style="color:#b392f0">  hostnamectl</span><span style="color:#9ecbff"> set-hostname</span><span style="color:#9ecbff"> namenode02</span></span>
<span class="line"><span style="color:#f97583">fi</span></span>
<span class="line"><span style="color:#f97583">if</span><span style="color:#e1e4e8"> [ </span><span style="color:#9ecbff">`</span><span style="color:#b392f0">ip</span><span style="color:#9ecbff"> a</span><span style="color:#f97583">|</span><span style="color:#b392f0">grep</span><span style="color:#9ecbff"> "192.168.125.63"</span><span style="color:#f97583">|</span><span style="color:#b392f0">wc</span><span style="color:#79b8ff"> -l</span><span style="color:#9ecbff">`</span><span style="color:#f97583"> -gt</span><span style="color:#79b8ff"> 0</span><span style="color:#e1e4e8"> ]; </span><span style="color:#f97583">then</span></span>
<span class="line"><span style="color:#b392f0">  hostnamectl</span><span style="color:#9ecbff"> set-hostname</span><span style="color:#9ecbff"> datanode01</span></span>
<span class="line"><span style="color:#f97583">fi</span></span>
<span class="line"><span style="color:#f97583">if</span><span style="color:#e1e4e8"> [ </span><span style="color:#9ecbff">`</span><span style="color:#b392f0">ip</span><span style="color:#9ecbff"> a</span><span style="color:#f97583">|</span><span style="color:#b392f0">grep</span><span style="color:#9ecbff"> "192.168.125.64"</span><span style="color:#f97583">|</span><span style="color:#b392f0">wc</span><span style="color:#79b8ff"> -l</span><span style="color:#9ecbff">`</span><span style="color:#f97583"> -gt</span><span style="color:#79b8ff"> 0</span><span style="color:#e1e4e8"> ]; </span><span style="color:#f97583">then</span></span>
<span class="line"><span style="color:#b392f0">  hostnamectl</span><span style="color:#9ecbff"> set-hostname</span><span style="color:#9ecbff"> datanode02</span></span>
<span class="line"><span style="color:#f97583">fi</span></span>
<span class="line"><span style="color:#f97583">if</span><span style="color:#e1e4e8"> [ </span><span style="color:#9ecbff">`</span><span style="color:#b392f0">ip</span><span style="color:#9ecbff"> a</span><span style="color:#f97583">|</span><span style="color:#b392f0">grep</span><span style="color:#9ecbff"> "192.168.125.65"</span><span style="color:#f97583">|</span><span style="color:#b392f0">wc</span><span style="color:#79b8ff"> -l</span><span style="color:#9ecbff">`</span><span style="color:#f97583"> -gt</span><span style="color:#79b8ff"> 0</span><span style="color:#e1e4e8"> ]; </span><span style="color:#f97583">then</span></span>
<span class="line"><span style="color:#b392f0">  hostnamectl</span><span style="color:#9ecbff"> set-hostname</span><span style="color:#9ecbff"> datanode03</span></span>
<span class="line"><span style="color:#f97583">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6a737d"># 重启以验证配置是否生效</span></span>
<span class="line"><span style="color:#b392f0">shtudown</span><span style="color:#79b8ff"> -r</span><span style="color:#9ecbff"> now</span></span></code></pre><h2 id="5-挂载分区">5 、挂载分区</h2><p>/data目录</p><h2 id="6配置免密登陆">6、配置免密登陆</h2><pre class="astro-code github-dark" data-language="plaintext" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span>ssh-keygen -t rsa # 一路回车，生成无密码密钥对。</span></span>
<span class="line"><span>#各节点分别执行</span></span>
<span class="line"><span>ssh-keygen -t dsa</span></span>
<span class="line"><span>ssh-copy-id namenode01</span></span>
<span class="line"><span>ssh-copy-id namenode02</span></span>
<span class="line"><span>ssh-copy-id datanode01</span></span>
<span class="line"><span>ssh-copy-id datanode02</span></span>
<span class="line"><span>ssh-copy-id datanode03</span></span>
<span class="line"><span>#测试</span></span>
<span class="line"><span>ssh namenode01</span></span>
<span class="line"><span>ssh namenode02</span></span>
<span class="line"><span>ssh datanode01</span></span>
<span class="line"><span>ssh datanode02</span></span>
<span class="line"><span>ssh datanode03</span></span></code></pre><h2 id="7配置-jdk-所有节点">7、配置 JDK (所有节点)</h2><pre class="astro-code github-dark" data-language="css" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#e1e4e8"># 默认安装在/usr/java文件夹下</span></span>
<span class="line"><span style="color:#e1e4e8">rpm -ivh </span><span style="color:#85e89d">oracle-j2sdk1</span><span style="color:#b392f0">.8-1.8.0</span><span style="color:#f97583">+</span><span style="color:#85e89d">update181-1</span><span style="color:#b392f0">.x86_64.rpm</span></span>
<span class="line"><span style="color:#e1e4e8"># 配置环境变量：编辑/etc/profile 或者 </span><span style="color:#f97583">~</span><span style="color:#e1e4e8">/</span><span style="color:#b392f0">.bash_profile</span></span>
<span class="line"><span style="color:#e1e4e8">vim /etc/profile</span></span>
<span class="line"><span style="color:#e1e4e8">---</span></span>
<span class="line"><span style="color:#e1e4e8">export JAVA_HOME=/usr/java/jdk1</span><span style="color:#b392f0">.8.0_181-cloudera</span></span>
<span class="line"><span style="color:#e1e4e8">export PATH=$</span><span style="color:#85e89d">PATH</span><span style="color:#e1e4e8">:$JAVA_HOME/bin</span></span>
<span class="line"><span style="color:#e1e4e8">---</span></span>
<span class="line"><span style="color:#85e89d">source</span><span style="color:#e1e4e8"> /etc/profile </span></span>
<span class="line"><span style="color:#e1e4e8"># 测试</span></span>
<span class="line"><span style="color:#e1e4e8">java -version</span></span></code></pre><h2 id="8安装第三方依赖及配置系统参数所有节点">8、安装第三方依赖及配置系统参数（所有节点）</h2><pre class="astro-code github-dark" data-language="plaintext" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span>yum install -y chkconfig python bind-utils psmisc libxslt zlib sqlite cyrus-sasl-plain cyrus-sasl-gssapi fuse fuse-libs redhat-lsb</span></span></code></pre><h2 id="9搭建本地yum源">9、搭建本地yum源</h2><ul><li>我这里选择把yum源配置在namenode01节点上</li></ul><h3 id="91-安装并启动apache-http">9.1 安装并启动Apache http</h3><ul><li><p>在namenode01节点完成以下操作**</p></li><li><p>安装Apache http</p><pre class="astro-code github-dark" data-language="bash" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#b392f0">yum</span><span style="color:#9ecbff"> install</span><span style="color:#79b8ff"> -y</span><span style="color:#9ecbff"> httpd</span></span></code></pre></li><li><p>启动Apache http</p><pre class="astro-code github-dark" data-language="bash" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#b392f0">systemctl</span><span style="color:#9ecbff"> start</span><span style="color:#9ecbff"> httpd</span></span></code></pre></li><li><p>设置自启动Apache http</p><pre class="astro-code github-dark" data-language="bash" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#b392f0">systemctl</span><span style="color:#9ecbff"> enable</span><span style="color:#9ecbff"> httpd</span></span></code></pre></li></ul><h3 id="92-上传安装文件">9.2 上传安装文件</h3><ul><li><p>在namenode01节点完成以下操作</p></li><li><p>创建安装文件http根目录</p><pre class="astro-code github-dark" data-language="bash" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#b392f0">mkdir</span><span style="color:#79b8ff"> -p</span><span style="color:#9ecbff"> /var/www/html/cm6</span></span></code></pre></li><li><p>上传安装文件到http根目录</p></li><li><p>上传后查看文件</p><pre class="astro-code github-dark" data-language="bash" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#b392f0">ll</span><span style="color:#9ecbff"> /var/www/html/cm6</span></span></code></pre><ul><li><p>执行结果</p><pre class="astro-code github-dark" data-language="bash" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#b392f0">cloudera-manager-agent-6.3.1-1466458.el7.x86_64.rpm</span></span>
<span class="line"><span style="color:#b392f0">cloudera-manager-daemons-6.3.1-1466458.el7.x86_64.rpm</span></span>
<span class="line"><span style="color:#b392f0">cloudera-manager-server-6.3.1-1466458.el7.x86_64.rpm</span></span>
<span class="line"><span style="color:#b392f0">cloudera-manager-server-db-2-6.3.1-1466458.el7.x86_64.rpm</span></span>
<span class="line"><span style="color:#b392f0">enterprise-debuginfo-6.3.1-1466458.el7.x86_64.rpm</span></span></code></pre></li></ul></li></ul><h3 id="93-创建yum仓库">9.3 创建yum仓库</h3><ul><li>在namenode01节点完成以下操作</li></ul><pre class="astro-code github-dark" data-language="bash" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#79b8ff">cd</span><span style="color:#9ecbff"> /var/www/html/cm6</span></span>
<span class="line"><span style="color:#b392f0">yum</span><span style="color:#9ecbff"> install</span><span style="color:#79b8ff"> -y</span><span style="color:#9ecbff"> createrepo</span></span>
<span class="line"><span style="color:#b392f0">createrepo</span><span style="color:#9ecbff"> .</span></span></code></pre><h3 id="94-配置yum仓库文件">9.4 配置yum仓库文件</h3><ul><li>在所有节点完成以下操作</li></ul><pre class="astro-code github-dark" data-language="bash" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#b392f0">vim</span><span style="color:#9ecbff"> /etc/yum.repos.d/cloudera-manager.repo</span></span>
<span class="line"><span style="color:#e1e4e8">[cloudera-manager]</span></span>
<span class="line"><span style="color:#e1e4e8">name</span><span style="color:#f97583">=</span><span style="color:#9ecbff">Cloudera</span><span style="color:#b392f0"> Manager</span><span style="color:#79b8ff"> 6.3.1</span></span>
<span class="line"><span style="color:#e1e4e8">baseurl</span><span style="color:#f97583">=</span><span style="color:#9ecbff">http://namenode01/cm6</span></span>
<span class="line"><span style="color:#e1e4e8">gpgcheck</span><span style="color:#f97583">=</span><span style="color:#9ecbff">0</span></span>
<span class="line"><span style="color:#e1e4e8">enabled</span><span style="color:#f97583">=</span><span style="color:#9ecbff">1</span></span>
<span class="line"><span style="color:#e1e4e8">autorefresh</span><span style="color:#f97583">=</span><span style="color:#9ecbff">0</span></span>
<span class="line"><span style="color:#e1e4e8">type</span><span style="color:#f97583">=</span><span style="color:#9ecbff">rpm-md</span></span></code></pre><h3 id="95-更新仓库信息确认本地yum源已被添加">9.5 更新仓库信息，确认本地yum源已被添加</h3><pre class="astro-code github-dark" data-language="powershell" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#e1e4e8">yum </span><span style="color:#f97583">clean</span><span style="color:#e1e4e8"> all</span></span>
<span class="line"><span style="color:#e1e4e8">yum makecache</span></span></code></pre><h1 id="二安装-cm-和-cdh">二、安装 CM 和 CDH</h1><h2 id="1修改centos内核参数">1、修改centos内核参数</h2><p>vim /etc/sysctl.conf，增加以下内容</p><pre class="astro-code github-dark" data-language="plaintext" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span>kernel.sysrq = 0</span></span>
<span class="line"><span>kernel.core_uses_pid = 1</span></span>
<span class="line"><span>kernel.msgmnb = 65536</span></span>
<span class="line"><span>kernel.msgmax = 65536</span></span>
<span class="line"><span>kernel.shmmax = 6580110</span></span>
<span class="line"><span>kernel.shmall = 6580110</span></span>
<span class="line"><span>net.ipv4.ip_forward = 0</span></span>
<span class="line"><span>net.ipv4.conf.default.rp_filter = 0</span></span>
<span class="line"><span>net.ipv4.conf.all.rp_filter = 0</span></span>
<span class="line"><span>net.ipv4.icmp_echo_ignore_all = 0</span></span>
<span class="line"><span>net.ipv4.icmp_echo_ignore_broadcasts</span></span>
<span class="line"><span>net.ipv4.conf.default.accept_source_route = 0</span></span>
<span class="line"><span>net.ipv4.tcp_syncookies = 1</span></span>
<span class="line"><span>net.ipv4.tcp_max_tw_buckets = 6000</span></span>
<span class="line"><span>net.ipv4.tcp_sack = 1</span></span>
<span class="line"><span>net.ipv4.tcp_window_scaling = 1</span></span>
<span class="line"><span>net.ipv4.tcp_rmem = 10240 87380 12582912</span></span>
<span class="line"><span>net.ipv4.tcp_wmem = 10240 87380 12582912</span></span>
<span class="line"><span>net.ipv4.tcp_mem = 94500000 915000000 927000000</span></span>
<span class="line"><span>net.core.wmem_default = 8388608</span></span>
<span class="line"><span>net.core.rmem_default = 8388608</span></span>
<span class="line"><span>net.core.rmem_max = 16777216</span></span>
<span class="line"><span>net.core.wmem_max = 16777216</span></span>
<span class="line"><span>net.core.netdev_max_backlog = 262144</span></span>
<span class="line"><span>net.core.somaxconn = 40960</span></span>
<span class="line"><span>net.ipv4.tcp_max_orphans = 3276800</span></span>
<span class="line"><span>net.ipv4.tcp_max_syn_backlog = 262144</span></span>
<span class="line"><span>net.ipv4.tcp_timestamps = 0</span></span>
<span class="line"><span>net.ipv4.tcp_synack_retries = 2</span></span>
<span class="line"><span>net.ipv4.tcp_syn_retries = 2</span></span>
<span class="line"><span>net.ipv4.tcp_tw_recycle = 1</span></span>
<span class="line"><span>net.ipv4.tcp_tw_reuse = 1</span></span>
<span class="line"><span>net.ipv4.tcp_fin_timeout = 1</span></span>
<span class="line"><span>net.ipv4.tcp_keepalive_time = 30</span></span>
<span class="line"><span>net.ipv4.ip_local_port_range = 1024 65000</span></span>
<span class="line"><span>net.ipv6.conf.all.disable_ipv6 = 1</span></span>
<span class="line"><span>net.ipv6.conf.default.disable_ipv6 = 1</span></span>
<span class="line"><span>net.netfilter.nf_conntrack_max = 6553500</span></span>
<span class="line"><span>net.netfilter.nf_conntrack_tcp_timeout_close_wait = 60</span></span>
<span class="line"><span>net.netfilter.nf_conntrack_tcp_timeout_fin_wait = 120</span></span>
<span class="line"><span>net.netfilter.nf_conntrack_tcp_timeout_time_wait = 120</span></span>
<span class="line"><span>net.netfilter.nf_conntrack_tcp_timeout_established = 3600</span></span>
<span class="line"><span>net.nf_conntrack_max = 6553500</span></span>
<span class="line"><span>vm.overcommit_memory = 0</span></span>
<span class="line"><span>vm.swappiness = 0</span></span>
<span class="line"><span>fs.file-max = 999999</span></span>
<span class="line"><span>net.ipv4.tcp_max_tw_buckets = 6000</span></span>
<span class="line"><span>net.ipv4.ip_local_port_range = 1024 65000</span></span>
<span class="line"><span>net.ipv4.tcp_tw_recycle = 1</span></span>
<span class="line"><span>net.ipv4.tcp_tw_reuse = 1</span></span>
<span class="line"><span>net.ipv4.tcp_keepalive_time = 30</span></span>
<span class="line"><span>net.ipv4.tcp_syncookies = 1</span></span>
<span class="line"><span>net.core.somaxconn = 40960</span></span>
<span class="line"><span>net.core.netdev_max_backlog = 262144</span></span>
<span class="line"><span>net.ipv4.tcp_max_syn_backlog = 262144</span></span>
<span class="line"><span>net.ipv4.tcp_rmem = 10240  87380  12582912</span></span>
<span class="line"><span>net.ipv4.tcp_wmem = 10240 87380 12582912</span></span>
<span class="line"><span>net.core.rmem_default = 6291456</span></span>
<span class="line"><span>net.core.wmem_default = 6291456</span></span>
<span class="line"><span>net.core.rmem_max = 12582912</span></span>
<span class="line"><span>net.core.wmem_max = 12582912</span></span>
<span class="line"><span>net.ipv4.tcp_syncookies = 1</span></span></code></pre><p>vim /etc/security/limits.conf，增加以下内容</p><pre class="astro-code github-dark" data-language="plaintext" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span>* soft nproc 65535 </span></span>
<span class="line"><span>* hard nproc 65535 </span></span>
<span class="line"><span>* soft nofile 65535 </span></span>
<span class="line"><span>* hard nofile 65535</span></span></code></pre><pre class="astro-code github-dark" data-language="plaintext" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span>sed -i "s/vm.swappiness = 30/vm.swappiness = 10/g" /usr/lib/tuned/virtual-guest/tuned.conf</span></span></code></pre><h2 id="2安装mysql数据库namenode01">2、安装mysql数据库(namenode01)</h2><pre class="astro-code github-dark" data-language="sql" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#e1e4e8"># 本地安装mysql, 按照如下顺序安装</span></span>
<span class="line"><span style="color:#e1e4e8">yum </span><span style="color:#f97583">-</span><span style="color:#e1e4e8">y localinstall mysql</span><span style="color:#f97583">-</span><span style="color:#e1e4e8">community</span><span style="color:#f97583">-</span><span style="color:#e1e4e8">common</span><span style="color:#f97583">-</span><span style="color:#79b8ff">5</span><span style="color:#e1e4e8">.</span><span style="color:#79b8ff">7</span><span style="color:#e1e4e8">.</span><span style="color:#79b8ff">29</span><span style="color:#f97583">-</span><span style="color:#79b8ff">1</span><span style="color:#e1e4e8">.</span><span style="color:#79b8ff">el7</span><span style="color:#e1e4e8">.</span><span style="color:#79b8ff">x86_64</span><span style="color:#e1e4e8">.rpm</span></span>
<span class="line"><span style="color:#e1e4e8">yum </span><span style="color:#f97583">-</span><span style="color:#e1e4e8">y localinstall mysql</span><span style="color:#f97583">-</span><span style="color:#e1e4e8">community</span><span style="color:#f97583">-</span><span style="color:#e1e4e8">libs</span><span style="color:#f97583">-</span><span style="color:#79b8ff">5</span><span style="color:#e1e4e8">.</span><span style="color:#79b8ff">7</span><span style="color:#e1e4e8">.</span><span style="color:#79b8ff">29</span><span style="color:#f97583">-</span><span style="color:#79b8ff">1</span><span style="color:#e1e4e8">.</span><span style="color:#79b8ff">el7</span><span style="color:#e1e4e8">.</span><span style="color:#79b8ff">x86_64</span><span style="color:#e1e4e8">.rpm</span></span>
<span class="line"><span style="color:#e1e4e8">yum </span><span style="color:#f97583">-</span><span style="color:#e1e4e8">y localinstall mysql</span><span style="color:#f97583">-</span><span style="color:#e1e4e8">community</span><span style="color:#f97583">-</span><span style="color:#e1e4e8">libs</span><span style="color:#f97583">-</span><span style="color:#e1e4e8">compat</span><span style="color:#f97583">-</span><span style="color:#79b8ff">5</span><span style="color:#e1e4e8">.</span><span style="color:#79b8ff">7</span><span style="color:#e1e4e8">.</span><span style="color:#79b8ff">29</span><span style="color:#f97583">-</span><span style="color:#79b8ff">1</span><span style="color:#e1e4e8">.</span><span style="color:#79b8ff">el7</span><span style="color:#e1e4e8">.</span><span style="color:#79b8ff">x86_64</span><span style="color:#e1e4e8">.rpm</span></span>
<span class="line"><span style="color:#e1e4e8">yum </span><span style="color:#f97583">-</span><span style="color:#e1e4e8">y localinstall mysql</span><span style="color:#f97583">-</span><span style="color:#e1e4e8">community</span><span style="color:#f97583">-</span><span style="color:#e1e4e8">devel</span><span style="color:#f97583">-</span><span style="color:#79b8ff">5</span><span style="color:#e1e4e8">.</span><span style="color:#79b8ff">7</span><span style="color:#e1e4e8">.</span><span style="color:#79b8ff">29</span><span style="color:#f97583">-</span><span style="color:#79b8ff">1</span><span style="color:#e1e4e8">.</span><span style="color:#79b8ff">el7</span><span style="color:#e1e4e8">.</span><span style="color:#79b8ff">x86_64</span><span style="color:#e1e4e8">.rpm</span></span>
<span class="line"><span style="color:#e1e4e8">yum </span><span style="color:#f97583">-</span><span style="color:#e1e4e8">y localinstall mysql</span><span style="color:#f97583">-</span><span style="color:#e1e4e8">community</span><span style="color:#f97583">-</span><span style="color:#e1e4e8">client</span><span style="color:#f97583">-</span><span style="color:#79b8ff">5</span><span style="color:#e1e4e8">.</span><span style="color:#79b8ff">7</span><span style="color:#e1e4e8">.</span><span style="color:#79b8ff">29</span><span style="color:#f97583">-</span><span style="color:#79b8ff">1</span><span style="color:#e1e4e8">.</span><span style="color:#79b8ff">el7</span><span style="color:#e1e4e8">.</span><span style="color:#79b8ff">x86_64</span><span style="color:#e1e4e8">.rpm</span></span>
<span class="line"><span style="color:#e1e4e8">yum </span><span style="color:#f97583">-</span><span style="color:#e1e4e8">y localinstall mysql</span><span style="color:#f97583">-</span><span style="color:#e1e4e8">community</span><span style="color:#f97583">-server-</span><span style="color:#79b8ff">5</span><span style="color:#e1e4e8">.</span><span style="color:#79b8ff">7</span><span style="color:#e1e4e8">.</span><span style="color:#79b8ff">29</span><span style="color:#f97583">-</span><span style="color:#79b8ff">1</span><span style="color:#e1e4e8">.</span><span style="color:#79b8ff">el7</span><span style="color:#e1e4e8">.</span><span style="color:#79b8ff">x86_64</span><span style="color:#e1e4e8">.rpm</span></span></code></pre><p>启动mysql</p><pre class="astro-code github-dark" data-language="plaintext" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span># 启动</span></span>
<span class="line"><span> systemctl start mysqld</span></span>
<span class="line"><span># 开机自启动</span></span>
<span class="line"><span> systemctl enable mysqld</span></span>
<span class="line"><span>#查看临时密码</span></span>
<span class="line"><span>cat /var/log/mysqld.log | grep password</span></span>
<span class="line"><span>mysql ‐uroot ‐p输入上面的临时密码</span></span>
<span class="line"><span>## 首次登录设置密码 root</span></span>
<span class="line"><span>set password=password('Sw++0066')</span></span>
<span class="line"><span> quit;</span></span>
<span class="line"><span># 再次登陆验证密码是否生效</span></span>
<span class="line"><span>mysql -uroot -pSw++0066</span></span></code></pre><h2 id="3初始化数据库">3、初始化数据库</h2><pre class="astro-code github-dark" data-language="bash" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#b392f0">/usr/bin/mysql_secure_installation</span></span></code></pre><p>按照下面提示输入。</p><pre class="astro-code github-dark" data-language="plaintext" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span>[...]</span></span>
<span class="line"><span>Enter current password for root (enter for none):</span></span>
<span class="line"><span>OK, successfully used password, moving on...</span></span>
<span class="line"><span>[...]</span></span>
<span class="line"><span>Set root password? [Y/n] Y</span></span>
<span class="line"><span>New password:</span></span>
<span class="line"><span>Re-enter new password:</span></span>
<span class="line"><span>[...]</span></span>
<span class="line"><span>Remove anonymous users? [Y/n] Y</span></span>
<span class="line"><span>[...]</span></span>
<span class="line"><span>Disallow root login remotely? [Y/n] N</span></span>
<span class="line"><span>[...]</span></span>
<span class="line"><span>Remove test database and access to it [Y/n] Y</span></span>
<span class="line"><span>[...]</span></span>
<span class="line"><span>Reload privilege tables now? [Y/n] Y</span></span>
<span class="line"><span>[...]</span></span>
<span class="line"><span>All done! </span></span></code></pre><h2 id="4安装-mysql-jdbc-驱动所有节点">4、安装 MySQL JDBC 驱动(所有节点)</h2><p>用于各节点连接数据库。</p><pre class="astro-code github-dark" data-language="bash" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#b392f0">wget</span><span style="color:#9ecbff"> https://dev.mysql.com/get/Downloads/Connector-J/mysql-connector-java-5.1.46.tar.gz</span></span>
<span class="line"><span style="color:#b392f0">tar</span><span style="color:#9ecbff"> xf</span><span style="color:#9ecbff"> mysql-connector-java-5.1.46.tar.gz</span></span>
<span class="line"><span style="color:#b392f0">mkdir</span><span style="color:#79b8ff"> -p</span><span style="color:#9ecbff"> /usr/share/java/</span></span>
<span class="line"><span style="color:#79b8ff">cd</span><span style="color:#9ecbff"> mysql-connector-java-5.1.46</span></span>
<span class="line"><span style="color:#b392f0">cp</span><span style="color:#9ecbff"> mysql-connector-java-5.1.46-bin.jar</span><span style="color:#9ecbff"> /usr/share/java/mysql-connector-java.jar</span></span></code></pre><h2 id="5为-cloudera-各软件创建数据库">5、为 Cloudera 各软件创建数据库</h2><p>密码的长度是由validate_password_length决定的,但是可以通过以下命令修改</p><pre class="astro-code github-dark" data-language="plaintext" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span>set global validate_password_length=4;</span></span></code></pre><p>validate_password_policy决定密码的验证策略,默认等级为MEDIUM(中等),可通过以下命令修改为</p><p>LOW(低)</p><pre class="astro-code github-dark" data-language="plaintext" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span>set global validate_password_policy=0;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>create user 'root'@'%' identified by 'Sw++0066';</span></span>
<span class="line"><span>create user 'root'@'namenode01' identified by 'Sw++0066';</span></span>
<span class="line"><span>create database hive DEFAULT CHARSET utf8 COLLATE utf8_general_ci;</span></span>
<span class="line"><span>create database hue DEFAULT CHARSET utf8 COLLATE utf8_general_ci;</span></span>
<span class="line"><span>create database monitor DEFAULT CHARSET utf8 COLLATE utf8_general_ci;</span></span>
<span class="line"><span>create database cmf DEFAULT CHARSET utf8 COLLATE utf8_general_ci;</span></span>
<span class="line"><span>create database oozie DEFAULT CHARSET utf8 COLLATE utf8_general_ci;</span></span>
<span class="line"><span>grant all privileges on *.* to 'root'@'localhost';</span></span>
<span class="line"><span>grant all privileges on *.* to 'root'@'%';</span></span>
<span class="line"><span>grant all privileges on *.* to 'root'@'namenode01';</span></span>
<span class="line"><span>flush privileges;</span></span>
<span class="line"><span>exit</span></span></code></pre><h2 id="6安装-cm-server-和-agent">6、安装 CM Server 和 Agent</h2><ul><li><strong>namenode0[1-2]</strong>：</li></ul><pre class="astro-code github-dark" data-language="sql" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#e1e4e8">yum </span><span style="color:#f97583">-</span><span style="color:#e1e4e8">y install cloudera</span><span style="color:#f97583">-</span><span style="color:#e1e4e8">manager</span><span style="color:#f97583">-</span><span style="color:#e1e4e8">daemons cloudera</span><span style="color:#f97583">-</span><span style="color:#e1e4e8">manager</span><span style="color:#f97583">-</span><span style="color:#e1e4e8">agent cloudera</span><span style="color:#f97583">-</span><span style="color:#e1e4e8">manager</span><span style="color:#f97583">-server</span></span></code></pre><ul><li><strong>datanode0[1-3]</strong>：</li></ul><pre class="astro-code github-dark" data-language="plaintext" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span>yum -y install cloudera-manager-daemons cloudera-manager-agent</span></span></code></pre><p>修改agent配置，指向server节点namenode01(所有节点)</p><pre class="astro-code github-dark" data-language="plaintext" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span>sed -i "s/server_host=localhost/server_host=namenode01/g" /etc/cloudera-scm-agent/config.ini</span></span></code></pre><p>修改主节点namenode01的server配置</p><pre class="astro-code github-dark" data-language="plaintext" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span>vim /etc/cloudera-scm-server/db.properties</span></span>
<span class="line"><span># Copyright (c) 2012 Cloudera, Inc. All rights reserved.</span></span>
<span class="line"><span>#</span></span>
<span class="line"><span># This file describes the database connection.</span></span>
<span class="line"><span>#</span></span>
<span class="line"><span># The database type</span></span>
<span class="line"><span># Currently 'mysql', 'postgresql' and 'oracle' are valid databases.</span></span>
<span class="line"><span>com.cloudera.cmf.db.type=mysql</span></span>
<span class="line"><span># The database host</span></span>
<span class="line"><span># If a non standard port is needed, use 'hostname:port'</span></span>
<span class="line"><span>com.cloudera.cmf.db.host=namenode01:3306</span></span>
<span class="line"><span># The database name</span></span>
<span class="line"><span>com.cloudera.cmf.db.name=cmf</span></span>
<span class="line"><span># The database user</span></span>
<span class="line"><span>com.cloudera.cmf.db.user=root</span></span>
<span class="line"><span># The database user's password</span></span>
<span class="line"><span>com.cloudera.cmf.db.password=Sw++0066</span></span>
<span class="line"><span># The db setup type</span></span>
<span class="line"><span># After fresh install it is set to INIT</span></span>
<span class="line"><span># and will be changed post config.</span></span>
<span class="line"><span># If scm-server uses Embedded DB then it is set to EMBEDDED</span></span>
<span class="line"><span># If scm-server uses External DB then it is set to EXTERNAL</span></span>
<span class="line"><span>com.cloudera.cmf.db.setupType=EXTERNAL</span></span></code></pre><p>启动cm的sever和agent，开始安装cdh集群</p><pre class="astro-code github-dark" data-language="plaintext" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span># 在namenode01上启动server</span></span>
<span class="line"><span>systemctl start cloudera-scm-server</span></span>
<span class="line"><span># 另开一个窗口，查看相关日志。有异常就解决异常</span></span>
<span class="line"><span>tail ‐200f /var/log/cloudera‐scm‐server/cloudera‐scm‐server.log</span></span>
<span class="line"><span># 这个异常可以忽略 ERROR ParcelUpdateService:com.cloudera.parcel.component</span></span>
<span class="line"><span>ParcelDownloaderImpl: Unable to retrieve remote parcel repository manifes</span></span>
<span class="line"><span># 等待日志输出 started jetty server, 则cm-server启动成功</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 在全部节点上启动agent</span></span>
<span class="line"><span>systemctl start cloudera-scm-agent</span></span>
<span class="line"><span> # 当在 namenode01上 netstat ‐antp | grep 7180 有内容时，说明我们可以访问web页面了</span></span>
<span class="line"><span># 查看运行状态</span></span>
<span class="line"><span>systemctl status cloudera-scm-agent</span></span>
<span class="line"><span>systemctl status cloudera-scm-server</span></span></code></pre><h2 id="7安装cdh">7、安装CDH</h2><p>1.上传CDH parcel到Cloudera Manager Server节点的/opt/cloudera/parcel-repo路径下，上传CDH所需parcel</p><p>2.为parcel文件生成SHA1校验文件</p><pre class="astro-code github-dark" data-language="plaintext" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span>sha1sum CDH-6.3.2-1.cdh6.3.2.p0.1605554-el7.parcel | awk '{ print $1 }' > CDH-6.3.2-1.cdh6.3.2.p0.1605554-el7.parcel.sha</span></span></code></pre><p>3.更改parcel文件所有者</p><pre class="astro-code github-dark" data-language="plaintext" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span>chown -R cloudera-scm:cloudera-scm /opt/cloudera/parcel-repo/*</span></span></code></pre><p>4.重启Cloudera Manager，令其识别到本地库</p><pre class="astro-code github-dark" data-language="plaintext" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span>systemctl restart cloudera-scm-server</span></span></code></pre><p>5.登录Cloudera Manager，初始用户名和密码均为admin。</p><p>浏览器打开<code>http://192.168.125.61:7180</code>，用户名和密码默认都是<code>admin</code>。</p><p><img alt="image-20230529091705052" loading="lazy" src="/images/image-20230529091705052.png"></p><p>接收许可。</p><p><img alt="image-20230530121712410" loading="lazy" src="/images/image-20230530121712410.png"> 这里我们选择免费版。</p><p><img alt="image-20230530121746876" loading="lazy" src="/images/image-20230530121746876.png"></p><h1 id="三集群安装">三、集群安装</h1><p><img alt="image-20230529092249259" loading="lazy" src="/images/image-20230529092249259.png"> 指定要添加的节点。</p><p><img alt="image-20230529115211986" loading="lazy" src="/images/image-20230529115211986.png"> 选择存储库，之前我们已经在 CM Server 节点配置好了。</p><p><img alt="image-20230529115234989" loading="lazy" src="/images/image-20230529115234989.png"> 等待在集群中分配、解压、激活CDH parcel，完成后点击继续，检查主机正确性。</p><p><img alt="image-20230529115943125" loading="lazy" src="/images/image-20230529115943125.png"></p><p>选择安装的服务</p><p><img alt="image-20230529124821194" loading="lazy" src="/images/image-20230529124821194.png"></p><p>分配集群角色</p><p><img alt="image-20230630172303308" loading="lazy" src="/images/image-20230630172303308.png"></p><p>测试数据库连接</p><p><img alt="image-20230630172946342" loading="lazy" src="/images/image-20230630172946342.png"></p><p>审核各服务参数的默认配置，所有目录均放置在/data下。</p><p><img alt="image-20230630173244279" loading="lazy" src="/images/image-20230630173244279.png"></p><p>等待安装，完成后点继续。<img alt="image-20230630175330831" loading="lazy" src="/images/image-20230630175330831.png"></p><p><img alt="image-20230529141236014" loading="lazy" src="/images/image-20230529141236014.png"></p><h1 id="四kudu安装">四、KUDU安装</h1><h2 id="1上传压缩包到">1、上传压缩包到 ~/</h2><pre class="astro-code github-dark" data-language="plaintext" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span>unzip kudu-1.12-x.zip</span></span>
<span class="line"><span>tar zxf gradle.tar.gz</span></span></code></pre><h2 id="2准备安装目录和yum安装基础依赖">2、准备安装目录和yum安装基础依赖</h2><pre class="astro-code github-dark" data-language="plaintext" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span>mkdir -p /data/soft/</span></span>
<span class="line"><span>yum -y install numactl numactl-devel autoconf automake cyrus-sasl-devel cyrus-sasl-gssapi cyrus-sasl-plain flex gcc gcc-c++ gdb git krb5-server krb5-workstation libtool make openssl-devel patch pkgconfig redhat-lsb-core rsync unzip vim-common which scl-utils git devtoolset-3-toolchain numactl-libs doxygen gem graphviz ruby-devel zlib-devel</span></span></code></pre><h2 id="3安装-memkind">3、安装 memkind</h2><pre class="astro-code github-dark" data-language="plaintext" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span>git clone https://github.com/memkind/memkind.git</span></span>
<span class="line"><span>cd /data/soft/</span></span>
<span class="line"><span>yum remove memkind</span></span>
<span class="line"><span>unzip memkind-master.zip</span></span>
<span class="line"><span>cd memkind-master</span></span>
<span class="line"><span>./build.sh --prefix=/usr</span></span>
<span class="line"><span>ldconfig</span></span>
<span class="line"><span>make install</span></span>
<span class="line"><span>ldconfig</span></span></code></pre><h2 id="4安装kudu">4、安装kudu</h2><pre class="astro-code github-dark" data-language="plaintext" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span>cd /data/soft/</span></span>
<span class="line"><span>unzip kudu-1.12-x.zip</span></span>
<span class="line"><span>cp src/gradle-wrapper.jar /data/soft/kudu-1.12.x/java/gradle/wrapper</span></span>
<span class="line"><span>cd kudu-1.12.0</span></span>
<span class="line"><span>mkdir -p /data/soft/kudu-1.12.x/thirdparty/src/</span></span>
<span class="line"><span>mkdir -p /data/soft/kudu-1.12.x/thirdparty/src/postgresql-42.2.10</span></span>
<span class="line"><span>cp kudu-1.12-x/src/postgresql-42.2.10.jar /data/soft/kudu-1.12.x/thirdparty/src/postgresql-42.2.10</span></span>
<span class="line"><span>cd /data/soft/kudu-1.12.x/</span></span>
<span class="line"><span>build-support/enable_devtoolset.sh thirdparty/build-if-necessary.sh</span></span>
<span class="line"><span>mkdir -p build/release</span></span>
<span class="line"><span>cd build/release</span></span>
<span class="line"><span>../../build-support/enable_devtoolset.sh \</span></span>
<span class="line"><span>../../thirdparty/installed/common/bin/cmake \</span></span>
<span class="line"><span>-DCMAKE_BUILD_TYPE=release ../..</span></span>
<span class="line"><span>ldconfig</span></span>
<span class="line"><span>make -j4</span></span>
<span class="line"><span>！！！注意，这个步骤安装后只是编译完成，没有进行install，可以根据自己的情况进行修改</span></span></code></pre><h2 id="5增加环境变量-或者ln-仅供参考">5、增加环境变量 或者ln 仅供参考</h2><pre class="astro-code github-dark" data-language="plaintext" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span>kudu-tserver and kudu-master executables in /usr/local/sbin</span></span>
<span class="line"><span>Kudu command line tool in /usr/local/bin</span></span>
<span class="line"><span>Kudu client library in /usr/local/lib64/</span></span>
<span class="line"><span>Kudu client headers in /usr/local/include/kudu</span></span>
<span class="line"><span>ln -sv /data/soft/kudu-1.12.x/build/release/bin/kudu-master /usr/sbin/</span></span>
<span class="line"><span>ln -sv /data/soft/kudu-1.12.x/build/release/bin/kudu-tserver /usr/sbin/</span></span></code></pre><h2 id="6web页面如果不在默认位置记得加启动参数指定web目录">6、web页面如果不在默认位置，记得加启动参数指定web目录</h2><pre class="astro-code github-dark" data-language="plaintext" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span>--webserver_doc_root=/data/soft/kudu-1.12.0/www</span></span></code></pre><h2 id="7如果要安装到指定目录需要直接make-install">7、如果要安装到指定目录，需要直接make install</h2><pre class="astro-code github-dark" data-language="plaintext" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span>make DESTDIR=/data/soft/kudu-1.12.0/ install</span></span></code></pre><h2 id="8编译doc文档">8、编译doc文档</h2><pre class="astro-code github-dark" data-language="plaintext" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span>make docs</span></span></code></pre><h2 id="9集群内安装">9、集群内安装</h2><p>登录<a href="http://192.168.120.201:7180/%EF%BC%8C%E7%82%B9%E5%87%BB%E6%B7%BB%E5%8A%A0%E6%9C%8D%E5%8A%A1">http://192.168.120.201:7180/，点击添加服务</a></p><p><img alt="image-20230531093130963" loading="lazy" src="/images/image-20230531093130963.png"></p><p>添加Kudu</p><p><img alt="image-20230531093149490" loading="lazy" src="/images/image-20230531093149490.png">自定义角色分配</p><p><img alt="image-20230531093224221" loading="lazy" src="/images/image-20230531093224221.png"></p><p>审核更改</p><p><img alt="image-20230531094041187" loading="lazy" src="/images/image-20230531094041187.png"></p><p>命令信息详情</p><p><img alt="image-20230531093857241" loading="lazy" src="/images/image-20230531093857241.png"></p><p>完成，访问<a href="http://192.168.120.201:8051/%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E5%A6%82%E4%B8%8B%E9%A1%B5%E9%9D%A2%EF%BC%8C%E8%A1%A8%E7%A4%BA%E5%AE%89%E8%A3%85%E6%88%90%E5%8A%9F%E3%80%82">http://192.168.120.201:8051/可以看到如下页面，表示安装成功。</a></p><p><img alt="image-20230531094507037" loading="lazy" src="/images/image-20230531094507037.png"></p><h2 id="10安装好后的配置">10、安装好后的配置</h2><p>impala启用kudu</p><p><img alt="image-20230531094704711" loading="lazy" src="/images/image-20230531094704711.png"></p><p>hive启用kudu</p><p><img alt="image-20230531095008035" loading="lazy" src="/images/image-20230531095008035.png"></p><p>安装YARN MapReduce框架JAR</p><p><img alt="image-20230531132734072" loading="lazy" src="/images/image-20230531132734072.png"></p><p><a href="http://192.168.120.202:888/">http://192.168.120.202:888/</a> hue登录账号和密码均为hue</p><h1 id="五tez安装">五、TEZ安装</h1><h2 id="1下载tez">1、下载TEZ</h2><p>官网：Apache Tez – Welcome to Apache TEZ®</p><p>采用Apache下载路径寻找：Welcome to The Apache Software Foundation!</p><p>选择编译版或者源码版下载：Index of /tez/0.9.2</p><p>直接下载：wget <a href="https://dlcdn.apache.org/tez/0.9.2/apache-tez-0.9.2-src.tar.gz">https://dlcdn.apache.org/tez/0.9.2/apache-tez-0.9.2-src.tar.gz</a></p><h2 id="2下载maven">2、下载Maven</h2><p>wget <a href="https://archive.apache.org/dist/maven/maven-3/3.8.5/binaries/apache-maven-3.8.5-bin.tar.gz">https://archive.apache.org/dist/maven/maven-3/3.8.5/binaries/apache-maven-3.8.5-bin.tar.gz</a></p><h2 id="3下载安装protobuf">3、下载安装protobuf</h2><p>注：源码编译过程中hadoop中需要使用protobuf，需要下载protobuf-2.5.0</p><p>wget <a href="https://github.com/protocolbuffers/protobuf/releases/download/v2.5.0/protobuf-2.5.0.tar.gz">https://github.com/protocolbuffers/protobuf/releases/download/v2.5.0/protobuf-2.5.0.tar.gz</a></p><h2 id="4安装maven">4、安装maven</h2><p>解压</p><p>[root@node02 ~]# cd /data1/software/tez/ [root@node02 tez]# tar -zxvf apache-maven-3.8.5-bin.tar.gz -C /data1/program/ 配置/etc/profile</p><p>[root@node02 tez]# vim /etc/profile #在最后一行输入以下内容 #maven export MAVEN_HOME=/data1/program/apache-maven-3.8.5 export PATH=$PATH:$MAVEN_HOME/bin 使配置生效并校验</p><p>[root@node02 tez]# source /etc/profile [root@node02 tez]# mvn —version Apache Maven 3.8.5 (3599d3414f046de2324203b78ddcf9b5e4388aa0) Maven home: /data1/program/apache-maven-3.8.5 Java version: 1.8.0_181, vendor: Oracle Corporation, runtime: /usr/java/jdk1.8.0_181-cloudera/jre Default locale: zh_CN, platform encoding: UTF-8 OS name: “linux”, version: “5.4.243-1.el7.elrepo.x86_64”, arch: “amd64”, family: “unix” ##备注，若是maven有新版本，安装后不退出当前窗口还是会显示旧版本信息。退出后重新登录后显示正常。</p><h2 id="5安装protobuf">5、安装protobuf</h2><p>解压</p><p>[root@node02 tez]# tar -zxvf protobuf-2.5.0.tar.gz -C /data1/program/</p><p>配置并生效</p><p>[root@node02 tez]# vim /etc/profile #在最后一行输入以下内容 #protobuf-2.5.0 export POF_HOME=/data1/program/protobuf-2.5.0 export PATH=$PATH:$POF_HOME/bin [root@node02 tez]# source /etc/profile 编译安装</p><p>[root@node02 tez]# cd /data1/program/protobuf-2.5.0/ [root@node02 protobuf-2.5.0]# ./configure [root@node02 protobuf-2.5.0]# make &#x26;&#x26; make install ##注：如果在编译的过程中报错缺少c或者c++，使用yum方式安装后重试即可 验证</p><p>[root@node02 protobuf-2.5.0]# protoc —version libprotoc 2.5.0 注：当configure校验不通过的时候,缺少哪些包就安装,一般需要安装gcc</p><h2 id="6tez编译092版本">6、tez编译0.9.2版本</h2><p>解压</p><p>[root@node02 protobuf-2.5.0]# cd /data1/software/tez/ [root@node02 tez]# tar -zxvf apache-tez-0.9.2-src.tar.gz</p><p>修改配置文件pom.xml</p><p>##进行第二步配置文件命令 [root@node02 tez]# cd /data1/software/tez/apache-tez-0.9.2-src [root@node02 apache-tez-0.9.2-src]# vim pom.xml</p><p>&#x3C;hadoop.version>3.0.0-cdh6.3.2&#x3C;/hadoop.version></p><repository><id>cloudera</id><url><https : artifactory="" cloudera-repos="" repository.cloudera.com=""></https></url><name>Cloudera Repositories</name><snapshots><enabled>false</enabled></snapshots></repository><pluginrepository><id>cloudera</id><name>Cloudera Repositories</name><url><https : artifactory="" cloudera-repos="" repository.cloudera.com=""></https></url></pluginrepository><dependency><groupid>com.sun.jersey</groupid><artifactid>jersey-client</artifactid><version>1.19</version></dependency>maven编译<p>[root@node02 apache-tez-0.9.2-src]# mvn clean package -Dmaven.javadoc.skip=true -Dmaven.test.skip=true ##注:这样会跳过test编译,很快就编译完成 ##经过一段时间等待，所有输出选项均为SUCCESS则表示为编译通过</p><p>##Maven编译后的压缩包在项目的tez-dist/target目录下，没有编译成功是没有target这个目录的 ##查看是否成功 [root@node02 apache-tez-0.9.2-src]# cd /data1/software/tez/apache-tez-0.9.2-src/tez-dist/target [root@node02 apache-tez-0.9.2-src]# ll drwxr-xr-x 2 root root 6 6月 1 10:46 archive-tmp drwxr-xr-x 2 root root 183 6月 1 10:46 tez-0.9.2 drwxr-xr-x 2 root root 159 6月 1 10:46 tez-0.9.2-minimal -rw-r—r— 1 root root 18642 6月 1 10:46 tez-0.9.2-minimal.tar.gz -rw-r—r— 1 root root 20024 6月 1 10:46 tez-0.9.2.tar.gz</p><h2 id="7配置">7、配置</h2><p>上传到hdfs路径</p><p>[root@node02 target]# su hdfs bash-4.2$ hdfs dfs -mkdir /tez bash-4.2$ hdfs dfs -put tez-0.9.2.tar.gz /tez 配置客户端（每台集群机子都需要配置，切记，弄好了也可以scp过去）</p><p>在CDH里的lib目录生成tez目录</p><p>[root@node02 target]# mkdir -p /opt/cloudera/parcels/CDH-6.3.2-1.cdh6.3.2.p0.1605554/lib/tez/conf 生成tez_site.xml文件</p><p>[root@node02 target]# vim /opt/cloudera/parcels/CDH-6.3.2-1.cdh6.3.2.p0.1605554/lib/tez/conf/tez-site.xml ##一定要加${fs.defaultFS}，要不就找不到，这个就是第一步上传到hdfs的压缩包路径</p><pre class="astro-code github-dark" data-language="plaintext" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span>&#x3C;configuration></span></span>
<span class="line"><span> &#x3C;property></span></span>
<span class="line"><span>  &#x3C;name>tez.lib.uris&#x3C;/name></span></span>
<span class="line"><span>  &#x3C;value>${fs.defaultFS}/tez/tez-0.9.2.tar.gz&#x3C;/value></span></span>
<span class="line"><span> &#x3C;/property></span></span>
<span class="line"><span> &#x3C;property></span></span>
<span class="line"><span>  &#x3C;name>tez.use.cluster.hadoop-libs&#x3C;/name></span></span>
<span class="line"><span>  &#x3C;value>false&#x3C;/value></span></span>
<span class="line"><span> &#x3C;/property></span></span>
<span class="line"><span> &#x3C;property></span></span>
<span class="line"><span>  &#x3C;name>tez.am.launch.env&#x3C;/name></span></span>
<span class="line"><span>  &#x3C;value>LD_LIBRARY_PATH=${PARCELS_ROOT}/CDH/lib/hadoop/lib/native&#x3C;/value></span></span>
<span class="line"><span> &#x3C;/property></span></span>
<span class="line"><span> &#x3C;property></span></span>
<span class="line"><span>  &#x3C;name>tez.task.launch.env&#x3C;/name></span></span>
<span class="line"><span>  &#x3C;value>LD_LIBRARY_PATH=${PARCELS_ROOT}/CDH/lib/hadoop/lib/native&#x3C;/value></span></span>
<span class="line"><span> &#x3C;/property></span></span>
<span class="line"><span>&#x3C;/configuration></span></span></code></pre><p>拷贝jar包和lib目录</p><pre class="astro-code github-dark" data-language="plaintext" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span>[root@node02 target]# cd tez-0.9.2-minimal</span></span>
<span class="line"><span>[root@node02 tez-0.9.2-minimal]# cp ./*.jar /opt/cloudera/parcels/CDH-6.3.2-1.cdh6.3.2.p0.1605554/lib/tez/</span></span>
<span class="line"><span>[root@node02 tez-0.9.2-minimal]# cp -r ./lib /opt/cloudera/parcels/CDH-6.3.2-1.cdh6.3.2.p0.1605554/lib/tez/</span></span></code></pre><p>避免kryo的错误java.lang.ClassNotFoundException: com.esotericsoftware.kryo.Serializer</p><pre class="astro-code github-dark" data-language="plaintext" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span>[root@node02 tez-0.9.2-minimal]# cd /opt/cloudera/parcels/CDH-6.3.2-1.cdh6.3.2.p0.1605554/lib/hive/auxlib</span></span>
<span class="line"><span>[root@node02 auxlib]# mv hive-exec-2.1.1-cdh6.3.2-core.jar hive-exec-2.1.1-cdh6.3.2-core.jar.bak</span></span>
<span class="line"><span>[root@node02 auxlib]# mv hive-exec-core.jar hive-exec-core.jar.bak</span></span>
<span class="line"><span>[root@node02 auxlib]# cp /opt/cloudera/parcels/CDH-6.3.2-1.cdh6.3.2.p0.1605554/jars/kryo-2.22.jar /opt/cloudera/parcels/CDH-6.3.2-1.cdh6.3.2.p0.1605554/lib/tez/lib/</span></span></code></pre><p>tez/lib中包含slf4j的jar包，会打印较多日志，可以在客户端中去掉slf4j-api-1.7.10.jar、slf4j-log4j12-1.7.10.jar这两个jar包，减少日志打印，</p><p>配置HADOOP_CLASSPATH路径（这个在cdh上面配置就好），路径为hive-配置-gateway，hive-env.sh 的 Gateway 客户端环境高级配置代码段（安全阀），内容如下：</p><pre class="astro-code github-dark" data-language="plaintext" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span>HADOOP_CLASSPATH=/opt/cloudera/parcels/CDH-6.3.2-1.cdh6.3.2.p0.1605554/lib/tez/conf:/opt/cloudera/parcels/CDH-6.3.2-1.cdh6.3.2.p0.1605554/lib/tez/*:/opt/cloudera/parcels/CDH-6.3.2-1.cdh6.3.2.p0.1605554/lib/tez/lib/*</span></span></code></pre><p>然后保存并部署客户端配置，这样配置的环境变量才会生效。</p><p><img alt="image-20230601114530352" loading="lazy" src="/images/image-20230601114530352.png"></p><p>（此步无要求可以忽略）JDBC客户端无法连接，需要在Hive配置hive-site.xml 的 Hive 服务高级配置代码段</p><p>#插入一下代码 tez.lib.uris ${fs.defaultFS}/tez/tez-0.9.2.tar.gz</p><p>tez.use.cluster.hadoop-libs false</p><p>若是还报异常，需要吧之前整理的tez包放进/opt/cloudera/parcels/CDH-6.3.2-1.cdh6.3.2.p0.1605554/lib/hive/lib/。以下是我放的包 -rw-r—r— 1 root root 58160 May 11 17:07 commons-codec-1.4.jar -rw-r—r— 1 root root 41123 May 11 17:07 commons-cli-1.2.jar -rw-r—r— 1 root root 535731 May 11 17:07 async-http-client-1.8.16.jar -rw-r—r— 1 root root 588337 May 11 17:07 commons-collections-3.2.2.jar -rw-r—r— 1 root root 751238 May 11 17:07 commons-collections4-4.1.jar -rw-r—r— 1 root root 1599627 May 11 17:07 commons-math3-3.1.1.jar -rw-r—r— 1 root root 1648200 May 11 17:07 guava-11.0.2.jar -rw-r—r— 1 root root 770504 May 11 17:07 hadoop-mapreduce-client-common-3.0.0-cdh6.3.2.jar -rw-r—r— 1 root root 1644597 May 11 17:07 hadoop-mapreduce-client-core-3.0.0-cdh6.3.2.jar -rw-r—r— 1 root root 81743 May 11 17:07 jettison-1.3.4.jar -rw-r—r— 1 root root 147952 May 11 17:07 jersey-json-1.9.jar -rw-r—r— 1 root root 5450 May 11 17:07 hadoop-shim-2.7-0.9.2.jar -rw-r—r— 1 root root 8803 May 11 17:07 hadoop-shim-0.9.2.jar -rw-r—r— 1 root root 458642 May 11 17:07 jetty-util-9.3.24.v20180605.jar -rw-r—r— 1 root root 520813 May 11 17:07 jetty-server-9.3.24.v20180605.jar -rw-r—r— 1 root root 8866 May 11 17:07 slf4j-log4j12-1.7.10.jar -rw-r—r— 1 root root 32119 May 11 17:07 slf4j-api-1.7.10.jar -rw-r—r— 1 root root 105112 May 11 17:07 servlet-api-2.5.jar -rw-r—r— 1 root root 206280 May 11 17:07 RoaringBitmap-0.5.21.jar -rw-r—r— 1 root root 5362 May 11 17:07 tez-build-tools-0.9.2.jar -rw-r—r— 1 root root 1032647 May 11 17:07 tez-api-0.9.2.jar -rw-r—r— 1 root root 85864 May 11 17:07 tez-common-0.9.2.jar -rw-r—r— 1 root root 56795 May 11 17:07 tez-examples-0.9.2.jar -rw-r—r— 1 root root 1412824 May 11 17:07 tez-dag-0.9.2.jar -rw-r—r— 1 root root 76042 May 11 17:07 tez-protobuf-history-plugin-0.9.2.jar -rw-r—r— 1 root root 296849 May 11 17:07 tez-mapreduce-0.9.2.jar -rw-r—r— 1 root root 78934 May 11 17:07 tez-job-analyzer-0.9.2.jar -rw-r—r— 1 root root 15265 May 11 17:07 tez-javadoc-tools-0.9.2.jar -rw-r—r— 1 root root 79097 May 11 17:07 tez-history-parser-0.9.2.jar -rw-r—r— 1 root root 198892 May 11 17:07 tez-runtime-internals-0.9.2.jar -rw-r—r— 1 root root 7741 May 11 17:07 tez-yarn-timeline-history-with-acls-0.9.2.jar -rw-r—r— 1 root root 28162 May 11 17:07 tez-yarn-timeline-history-0.9.2.jar -rw-r—r— 1 root root 158966 May 11 17:07 tez-tests-0.9.2.jar -rw-r—r— 1 root root 768820 May 11 17:07 tez-runtime-library-0.9.2.jar 附上JDBC代码示例：</p><p>package com.test.controller;</p><p>import java.sql.*; import java.util.Properties;</p><p>/**</p><ul><li><p>@Author xxxx</p></li><li><p>@Date 2022-04-27 14:46</p></li><li><p>@Version 1.0 <em>/ public class TEZTestTwo { public static void main(String[] args) throws SQLException { String driverName = “org.apache.hive.jdbc.HiveDriver”; try { Class.forName(driverName); } catch (ClassNotFoundException e) { e.printStackTrace(); System.exit(1); } //<em>hiverserver 版本jdbc url格式</em>//</em> // Connection con = DriverManager.getConnection(“jdbc:hive://ip:10000/default”, "", ""); // <em>hiverserver2 版本jdbc url格式</em>//* // Connection con = DriverManager.getConnection(“jdbc:hive2://ip:10000/default”, “root”, ""); Properties properties = new Properties(); properties.setProperty(“user”,“root”); properties.setProperty(“password”,"");</p><pre class="astro-code github-dark" data-language="plaintext" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span>//这段和以下参数设置重叠，这两种都可以</span></span></code></pre><p>/*properties.setProperty(“hiveconf:hive.execution.engine”,“tez”); properties.setProperty(“hiveconf:tez.job.name”,“lytez”); //设置队列 prop.setProperty(“hiveconf:tez.queue.name”, “root.default”); //这个不一定要设置，不行的话再设置 properties.setProperty(“hiveconf:hive.tez.container.size”,“1024”);**/ Connection con = DriverManager.getConnection(“jdbc:hive2://ip:10000/default”, properties); Statement stmt = con.createStatement(); //参数设置测试 boolean resHivePropertyTest = stmt.execute(“set hive.execution.engine=tez”); //这个是yarn显示名称，这个需要修改源代码打包成：，替换：/opt/cloudera/parcels/CDH/jars/目录的hive-exec-2.1.1-cdh6.3.2.jar boolean resHivePropertyTestName = stmt.execute(“set tez.job.name=test”); //这个不一定要设置，不行的话再设置 boolean resHivePropertyTestContainer = stmt.execute(“set hive.tez.container.size=1024”); //cdh设置动态资源池 boolean setHivePropertyQUEUE = stmt.execute(“set tez.queue.name=root.default”); System.out.println(“resHivePropertyTestContainer=“+resHivePropertyTestContainer); System.out.println(“resHivePropertyTest=“+resHivePropertyTest); String tableName = “test”; ResultSet res = stmt.executeQuery(“select count(1) AS a from ” + tableName); while (res.next()) { System.out.println(res.getString(“a”)); } /<em>tableName=“area_type”; res = stmt.executeQuery(“select count(1) AS a from ” + tableName); while (res.next()) { System.out.println(res.getString(“a”)); }</em>/ } }</p></li></ul><h2 id="8启动">8、启动</h2><p>hive> set hive.execution.engine=tez; hive> set hive.tez.container.size=1024;</p><p>第一次查询的时候要加载jar包，所以比较慢。耐心点就好。示例：</p><p>hive> select count(1) from cwqejg_test2 ;</p></div><div class="flex flex-col justify-between max-w-3xl mx-auto sm:flex-row sm:px-6 mt-8 px-6"><ul class="mr-5 rtl:ml-5 rtl:mr-0"><li class="dark:bg-slate-700 bg-gray-100 font-medium inline-block lowercase mb-2 mr-2 px-2 py-0.5 rtl:ml-2 rtl:mr-0"><a href="/tag/cdh" class="text-muted hover:text-primary dark:hover:text-gray-200 dark:text-slate-300">cdh</a></li><li class="dark:bg-slate-700 bg-gray-100 font-medium inline-block lowercase mb-2 mr-2 px-2 py-0.5 rtl:ml-2 rtl:mr-0"><a href="/tag/devops" class="text-muted hover:text-primary dark:hover:text-gray-200 dark:text-slate-300">devops</a></li></ul><div class="align-middle dark:text-slate-600 mt-5 sm:mt-1 text-gray-500"><span class="font-bold align-super dark:text-slate-400 text-slate-500">Share:</span> <button class="ml-2 rtl:ml-0 rtl:mr-2" data-aw-social-share="twitter" data-aw-url="https://astrowind.vercel.app/how-to-setup-a-cdh-cluster" title="Twitter Share" data-aw-text="how to setup a cdh cluster"><svg class="w-6 h-6 dark:hover:text-slate-300 dark:text-slate-500 hover:text-black text-gray-400" data-icon="tabler:brand-x" height="1em" width="1em"><symbol id="ai:tabler:brand-x" viewBox="0 0 24 24"><path d="m4 4l11.733 16H20L8.267 4zm0 16l6.768-6.768m2.46-2.46L20 4" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></symbol><use href="#ai:tabler:brand-x"></use></svg></button> <button class="ml-2 rtl:ml-0 rtl:mr-2" data-aw-social-share="facebook" data-aw-url="https://astrowind.vercel.app/how-to-setup-a-cdh-cluster" title="Facebook Share"><svg class="w-6 h-6 dark:hover:text-slate-300 dark:text-slate-500 hover:text-black text-gray-400" data-icon="tabler:brand-facebook" height="1em" width="1em"><symbol id="ai:tabler:brand-facebook" viewBox="0 0 24 24"><path d="M7 10v4h3v7h4v-7h3l1-4h-4V8a1 1 0 0 1 1-1h3V3h-3a5 5 0 0 0-5 5v2z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></symbol><use href="#ai:tabler:brand-facebook"></use></svg></button> <button class="ml-2 rtl:ml-0 rtl:mr-2" data-aw-social-share="linkedin" data-aw-url="https://astrowind.vercel.app/how-to-setup-a-cdh-cluster" title="Linkedin Share" data-aw-text="how to setup a cdh cluster"><svg class="w-6 h-6 dark:hover:text-slate-300 dark:text-slate-500 hover:text-black text-gray-400" data-icon="tabler:brand-linkedin" height="1em" width="1em"><symbol id="ai:tabler:brand-linkedin" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M8 11v5m0-8v.01M12 16v-5m4 5v-3a2 2 0 1 0-4 0"/><path d="M3 7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4v10a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4z"/></g></symbol><use href="#ai:tabler:brand-linkedin"></use></svg></button> <button class="ml-2 rtl:ml-0 rtl:mr-2" data-aw-social-share="whatsapp" data-aw-url="https://astrowind.vercel.app/how-to-setup-a-cdh-cluster" title="Whatsapp Share" data-aw-text="how to setup a cdh cluster"><svg class="w-6 h-6 dark:hover:text-slate-300 dark:text-slate-500 hover:text-black text-gray-400" data-icon="tabler:brand-whatsapp" height="1em" width="1em"><symbol id="ai:tabler:brand-whatsapp" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="m3 21l1.65-3.8a9 9 0 1 1 3.4 2.9z"/><path d="M9 10a.5.5 0 0 0 1 0V9a.5.5 0 0 0-1 0za5 5 0 0 0 5 5h1a.5.5 0 0 0 0-1h-1a.5.5 0 0 0 0 1"/></g></symbol><use href="#ai:tabler:brand-whatsapp"></use></svg></button> <button class="ml-2 rtl:ml-0 rtl:mr-2" data-aw-social-share="mail" data-aw-url="https://astrowind.vercel.app/how-to-setup-a-cdh-cluster" title="Email Share" data-aw-text="how to setup a cdh cluster"><svg class="w-6 h-6 dark:hover:text-slate-300 dark:text-slate-500 hover:text-black text-gray-400" data-icon="tabler:mail" height="1em" width="1em"><symbol id="ai:tabler:mail" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M3 7a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><path d="m3 7l9 6l9-6"/></g></symbol><use href="#ai:tabler:mail"></use></svg></button></div></div></article></section><div class="mx-auto max-w-3xl sm:px-6 px-6 md:pb-20 md:pt-4 pb-12 pt-8"><a href="/blog" class="px-3 btn btn-tertiary md:px-3"><svg class="-ml-1.5 h-5 mr-1 rtl:-mr-1.5 rtl:ml-1 w-5" data-icon="tabler:chevron-left" height="1em" width="1em"><symbol id="ai:tabler:chevron-left" viewBox="0 0 24 24"><path d="m15 6l-6 6l6 6" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></symbol><use href="#ai:tabler:chevron-left"></use></svg> Back to Blog</a></div><section class="not-prose relative scroll-mt-[72px]"><div class="absolute inset-0 -z-[1] pointer-events-none" aria-hidden="true"><div class="absolute inset-0"></div></div><div class="mx-auto px-4 intersect-once intersect-once intersect-quarter intersect-quarter motion-safe:md:intersect:animate-fade motion-safe:md:intersect:animate-fade intercept-no-queue lg:pt-0 lg:py-20 max-w-7xl md:pt-0 md:px-6 md:py-16 motion-safe:md:opacity-0 pt-0 py-12 relative text-default"><div class="flex flex-col lg:flex-row lg:justify-between mb-8"><div class="md:max-w-sm"><h2 class="font-bold font-heading mb-2 group sm:leading-none sm:text-4xl text-3xl tracking-tight">Related Posts</h2><a href="/blog" class="text-muted dark:text-slate-400 block duration-200 ease-in hover:text-primary lg:mb-0 mb-6 transition">View All Posts »</a></div></div><div class="-mb-6 gap-6 grid lg:grid-cols-4 md:grid-cols-2 row-gap-5"><article class="transition mb-6 intersect-once intersect-quarter motion-safe:md:intersect:animate-fade motion-safe:md:opacity-0"><div class="dark:bg-slate-700 bg-gray-400 mb-6 md:h-64 relative rounded shadow-lg"><a href="/how-to-setup-a-n8n-server"><img alt="how to setup a n8n server" loading="lazy" src="https://i2.hdslb.com/bfs/archive/1b88ce7e29010144d02464e595553e2860316eb4.jpg" class="dark:bg-slate-700 bg-gray-400 rounded shadow-lg md:h-full w-full" crossorigin="anonymous" decoding="async" height="225" referrerpolicy="no-referrer" sizes="(max-width: 900px) 400px, 900px" srcset="https://i2.hdslb.com/bfs/archive/1b88ce7e29010144d02464e595553e2860316eb4.jpg 400w, https://i2.hdslb.com/bfs/archive/1b88ce7e29010144d02464e595553e2860316eb4.jpg 900w" style="object-fit:cover;object-position:center;max-width:100%;max-height:100%" width="400"></a></div><h3 class="font-bold font-heading mb-2 dark:text-slate-300 leading-tight sm:text-2xl text-xl"><a href="/how-to-setup-a-n8n-server" class="transition duration-200 ease-in hover:text-primary dark:hover:text-blue-700 inline-block">how to setup a n8n server</a></h3><p class="text-muted dark:text-slate-400 text-lg"></p></article></div></div></section></main><script>!function(){const e="system";if(window.basic_script)return;function t(e){"dark"===e?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}window.basic_script=!0;const d=function(){e&&e.endsWith(":only")||(localStorage.theme,0)?t(e.replace(":only","")):"dark"===localStorage.theme||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):t("light")};function a(e,t,d){const a="string"==typeof e?document.querySelectorAll(e):e;a&&a.length&&a.forEach((e=>{e.addEventListener(t,(t=>d(t,e)),!1)}))}d();const o=function(){let t=window.scrollY,d=!0;a("#header nav","click",(function(){document.querySelector("[data-aw-toggle-menu]")?.classList.remove("expanded"),document.body.classList.remove("overflow-hidden"),document.getElementById("header")?.classList.remove("h-screen"),document.getElementById("header")?.classList.remove("expanded"),document.getElementById("header")?.classList.remove("bg-page"),document.querySelector("#header nav")?.classList.add("hidden"),document.querySelector("#header > div > div:last-child")?.classList.add("hidden")})),a("[data-aw-toggle-menu]","click",(function(e,t){t.classList.toggle("expanded"),document.body.classList.toggle("overflow-hidden"),document.getElementById("header")?.classList.toggle("h-screen"),document.getElementById("header")?.classList.toggle("expanded"),document.getElementById("header")?.classList.toggle("bg-page"),document.querySelector("#header nav")?.classList.toggle("hidden"),document.querySelector("#header > div > div:last-child")?.classList.toggle("hidden")})),a("[data-aw-toggle-color-scheme]","click",(function(){e.endsWith(":only")||(document.documentElement.classList.toggle("dark"),localStorage.theme=document.documentElement.classList.contains("dark")?"dark":"light")})),a("[data-aw-social-share]","click",(function(e,t){const d=t.getAttribute("data-aw-social-share"),a=encodeURIComponent(t.getAttribute("data-aw-url")),o=encodeURIComponent(t.getAttribute("data-aw-text"));let n;switch(d){case"facebook":n=`https://www.facebook.com/sharer.php?u=${a}`;break;case"twitter":n=`https://twitter.com/intent/tweet?url=${a}&text=${o}`;break;case"linkedin":n=`https://www.linkedin.com/shareArticle?mini=true&url=${a}&title=${o}`;break;case"whatsapp":n=`https://wa.me/?text=${o}%20${a}`;break;case"mail":n=`mailto:?subject=%22${o}%22&body=${o}%20${a}`;break;default:return}const c=document.createElement("a");c.target="_blank",c.href=n,c.click()}));function o(){const e=document.querySelector("#header[data-aw-sticky-header]");e&&(t>60&&!e.classList.contains("scroll")?e.classList.add("scroll"):t<=60&&e.classList.contains("scroll")&&e.classList.remove("scroll"),d=!1)}window.matchMedia("(max-width: 767px)").addEventListener("change",(function(){document.querySelector("[data-aw-toggle-menu]")?.classList.remove("expanded"),document.body.classList.remove("overflow-hidden"),document.getElementById("header")?.classList.remove("h-screen"),document.getElementById("header")?.classList.remove("expanded"),document.getElementById("header")?.classList.remove("bg-page"),document.querySelector("#header nav")?.classList.add("hidden"),document.querySelector("#header > div > div:last-child")?.classList.add("hidden")})),o(),a([document],"scroll",(function(){t=window.scrollY,d||(window.requestAnimationFrame((()=>{o()})),d=!0)}))},n=function(){document.documentElement.classList.add("motion-safe:scroll-smooth");const e=document.querySelector("[data-aw-toggle-menu]");e&&e.classList.remove("expanded"),document.body.classList.remove("overflow-hidden"),document.getElementById("header")?.classList.remove("h-screen"),document.getElementById("header")?.classList.remove("expanded"),document.querySelector("#header nav")?.classList.add("hidden")};window.onload=o,window.onpageshow=n,document.addEventListener("astro:after-swap",(()=>{d(),o(),n()}))}()</script><script>const Observer={observer:null,delayBetweenAnimations:100,animationCounter:0,start(){const t=Array.from(document.querySelectorAll(['[class*=" intersect:"]','[class*=":intersect:"]','[class^="intersect:"]','[class="intersect"]','[class*=" intersect "]','[class^="intersect "]','[class$=" intersect"]'].join(",")));t.forEach((t=>{var e;t.setAttribute("no-intersect",""),t._intersectionThreshold=(e=t).classList.contains("intersect-full")?.99:e.classList.contains("intersect-half")?.5:e.classList.contains("intersect-quarter")?.25:0}));this.observer=new IntersectionObserver((t=>{t.forEach((t=>{requestAnimationFrame((()=>{const e=t.target,s=t.intersectionRatio,n=e._intersectionThreshold;if(e.classList.contains("intersect-no-queue"))t.isIntersecting?(e.removeAttribute("no-intersect"),e.classList.contains("intersect-once")&&this.observer.unobserve(e)):e.setAttribute("no-intersect","");else if(s>=n){if(!e.hasAttribute("data-animated")){e.removeAttribute("no-intersect"),e.setAttribute("data-animated","true");const t=this.animationCounter*this.delayBetweenAnimations;this.animationCounter++,e.style.transitionDelay=`${t}ms`,e.style.animationDelay=`${t}ms`,e.classList.contains("intersect-once")&&this.observer.unobserve(e)}}else e.setAttribute("no-intersect",""),e.removeAttribute("data-animated"),e.style.transitionDelay="",e.style.animationDelay="",this.animationCounter=0}))}))}).bind(this),{threshold:[0,.25,.5,.99]}),t.forEach((t=>{this.observer.observe(t)}))}};Observer.start(),document.addEventListener("astro:after-swap",(()=>{Observer.start()}))</script></body></html>